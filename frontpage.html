<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Domoticz Monitor</title> 
    <link href='http://fonts.googleapis.com/css?family=Orbitron:700' rel='stylesheet' type='text/css'>
    <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
    
    <meta name="author" content="Kevin van Hoorn" />
    <meta name="description" content="Vink&Hoorn Dashboard" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

<style>
div#cnt {
	width: 990px;
    margin: 0 auto;
    text-align: center;
    margin-top: 30px;
}

a, a:visited { text-decoration: none; color: #336699; }
a:hover { text-decoration: none; color: #003366; }

#frame {
	float: left;
	margin: 0px;
	padding: 0px 2px 0px 2px;
}

#desc_cell1, #desc_cell2, #desc_cell3, #desc_cell4,
#desc_cell5, #desc_cell6, #desc_cell7, #desc_cell8, #desc_cell9,
#desc_cell10, #desc_cell11, #desc_cell12, #desc_cell13, #desc_cell14,
#desc_cell15, #desc_cell16, #desc_cell17, #desc_cell18, #desc_cell19,
#desc_cell20, #desc_cell21, #desc_cell22, #desc_cell23, #desc_cell24
 {
	font-family: arial;
	font-weight: normal;
	color: #999;
	font-size: 17px;
	margin-top: -20px;
	height: 35px;
	line-height: 10px;
}

#cell1, #cell3, #cell5 {
	font-family: Arial, serif; /* Orbitron, serif; */
	font-weight: bold;
	width: 303px;
	padding: 6px;
	border: 1px solid #666;
	height: 250px;	
	line-height: 210px; 
	font-size: 100px;	
	color: green;
	margin: 0px ;
}

#cell6, #cell7, #cell8, #cell9, #cell10, 
#cell11, #cell12, #cell13, #cell14, #cell15, 
#cell16, #cell17, #cell18, #cell19, #cell20, 
#cell21, #cell22, #cell23   
     {
	font-family: Arial, serif; /* Orbitron, serif; */
	font-weight: bold;
	width: 162px;
	padding: 10px;
	padding-bottom: 15px;
	border: 1px solid #666;
	height: 90px;
	line-height: 75px; 		
	font-size: 90px;
	color: #999;
	font-size:40px;	
}

#cell6,  #cell7, #cell8, #cell9, #cell10,  
#cell11, #cell12, #cell13, #cell14, #cell15,
#cell16, #cell17, #cell18, #cell19, #cell20, 
#cell21, #cell22, #cell23 {
	height: 65px;
	line-height: 55px;
	color: #BBB;
}

#cell6,  #cell7, #cell8, #cell9, #cell10 {
    color: #666;
}

#cell16, #cell17, #cell18, #cell19, #cell20 {
    width: 214px;
}

#cell8, #cell13 { 
	width: 184px; 
}

#cell21, #cell22, #cell23 {
    width: 294px;
}

#all { 
	margin-left: -35px; 
	margin-top: 5px; 
	width: 1050px;height: 570px;	
}

</style>
</head>
<body bgcolor="#000">
<div id="cnt">

<div>
<div id="frame">
	<div id="cell1">--</div><div id="desc_cell1">cell1</div>
</div>
<div id="frame">
	<div id="cell3">--</div><div id="desc_cell3">cell3</div>
</div>
<div id="frame">
	<div id="cell5">--</div><div id="desc_cell5">cell5</div>
</div>
</div>

<div>
<div id="frame">
	<div id="cell6">--</div><div id="desc_cell6">cell6</div>
</div>
<div id="frame">
	<div id="cell7">--</div><div id="desc_cell7">cell7</div>
</div>
<div id="frame">
	<div id="cell8">--</div><div id="desc_cell8">cell8</div>
</div>
<div id="frame">
	<div id="cell9">--</div><div id="desc_cell9">cell9</div>
</div>
<div id="frame">
	<div id="cell10">--</div><div id="desc_cell10">cell10</div>
</div>
</div> 

<div>
<div id="frame">
	<div id="cell11">--</div><div id="desc_cell11">cell11</div>
</div>
<div id="frame">
	<div id="cell12">--</div><div id="desc_cell12">cell12</div>
</div>
<div id="frame">
	<div id="cell13">--</div><div id="desc_cell13">cell13</div>
</div>
<div id="frame">
	<div id="cell14">--</div><div id="desc_cell14">cell14</div>
</div>
<div id="frame">
	<div id="cell15">--</div><div id="desc_cell15">cell15</div>
</div>
</div>

<div>
<div id="frame">
	<div id="cell16">--</div><div id="desc_cell16">cell16</div>
</div>
<div id="frame">
	<div id="cell17">--</div><div id="desc_cell17">cell17</div>
</div>
<div id="frame">
	<div id="cell18">--</div><div id="desc_cell18">cell18</div>
</div>
<div id="frame">
	<div id="cell19">--</div><div id="desc_cell19">cell19</div>
</div>
<!--
<div id="frame">
	<div id="cell20">--</div><div id="desc_cell20">cell20</div>
</div>
-->
</div>

<div>
<div id="frame">
	<div id="cell21">--</div><div id="desc_cell21">cell21</div>
</div>
<div id="frame">
	<div id="cell22">--</div><div id="desc_cell22">cell22</div>
</div>
<div id="frame">
	<div id="cell23">--</div><div id="desc_cell23">cell23</div>
</div>
</div>

</div>

<script type="text/javascript" charset="utf-8">
function RefreshData()
{
	clearInterval($.refreshTimer);
	var jurl=$.domoticzurl+"/json.htm?type=devices&plan="+$.roomplan+"&jsoncallback=?";
	$.getJSON(jurl,
	{
		format: "json"
	},
	function(data) {
		if (typeof data.result != 'undefined') {
			
			$.each(data.result, function(i,item){
				for( var ii = 0, len = $.PageArray.length; ii < len; ii++ ) {
					if( $.PageArray[ii][0] === item.idx ) {		// Domoticz idx number
						var vtype=	$.PageArray[ii][1]; 		// Domotitcz type (like Temp, Humidity)
						var vlabel=	$.PageArray[ii][2];			// cell number from HTML layout
						var vdesc=	$.PageArray[ii][3];			// description 
						var vattr=	$.PageArray[ii][4];			// extra css attributes
						var valarm=	$.PageArray[ii][5]; 		// alarm value to turn text to red
						var ontext= $.PageArray[ii][6];         // text for on
						var offtext=$.PageArray[ii][7];         // text for off
						var clickable   =   ($.PageArray[ii][8] === undefined ? true : $.PageArray[ii][8]);       // clickable
						
						var suffix = vtype.match($.replaceRegex);
						
						if (suffix != null) {
    						vtype = vtype.replace($.replaceRegex, '');
    						suffix = suffix[1];
						} else {
    						suffix = '';
						}

						var vdata=	item[vtype];				// current value
						
						if (typeof vdata == 'undefined') {
							vdata="??";
						} else {
							// remove too much text
							vdata=new String(vdata).split("Watt",1)[0];
							vdata=new String(vdata).split("kWh",1)[0];
						}
						
						if (vtype == 'Temp')
						    vdata = parseInt(vdata);
						    
                        clickable2 = false;
						
						// create switchable value when item is switch
						switchclick='';
						if (vdata == 'Off' ) {
							if (clickable) {
							    switchclick = 'onclick="SwitchToggle('+item.idx+', \'On\');"';
							    clickable2 = true;
							 }
							vdata = offtext || vdata;
						}
						if (vdata == 'On' ) {
						    if (clickable) {
						        switchclick = 'onclick="SwitchToggle('+item.idx+', \'Off\');"';
						        clickable2 = true;
                            }
							vdata = ontext || vdata;
						}
						
						
						// if alarm threshold is defined, make value red 
						alarmcss='';
						if (typeof valarm != 'undefined') {
                            
                            if (typeof(vdata) == 'string')
                                expr = eval('"' + vdata + '"' + valarm);
                            else
                                expr = eval(vdata + valarm);
						    
							if (expr) {  // note orig:  vdata > alarm
								alarmcss=';color:red;';
							}
						}
						
						// if extra css attributes
						if (typeof vattr == 'undefined') {
							$('#'+vlabel).html('<div class="' + (clickable ? "clickable" : "") + '" '+switchclick+' style='+alarmcss+'>'+vdata+suffix+'</div>');
						} else {
							$('#'+vlabel).html( '<div class="' + (clickable ? "clickable" : "") + '" '+switchclick+' style='+vattr+alarmcss+'>'+vdata+suffix+'</div>');
						}
						
						$('#desc_'+vlabel).html(vdesc);
						
						if (clickable2) {
						    $obj = $('#desc_' + vlabel).closest('#frame').find('div:first');
						    $obj.css('border', '1px solid #FFF');
						    $obj.css('backgroundColor', '#204');
                        }
					}
				}
			});
		}
	});
	$.refreshTimer = setInterval(RefreshData, 8000);
}

// ############################################################################################################
// #### vvvvv   USER VALUES below vvvvv   #######
// ############################################################################################################

$(document).ready(function() {
	$.roomplan=16;   	// define roomplan in Domoticz and create items below.
	$.domoticzurl="http://192.168.0.58:8080";
	$.replaceRegex = /\{(.*)\}/;
	//format: idx, value, label, description, [override css], [alarm value]
	$.PageArray = [
        ['8',   'Temp{ ºC}',        'cell1',	'Woonkamer'             ,,      '>25'],
        ['12',  'Temp{ ºC}',        'cell3',	'Eindhoven'             ,,      '>28'],
        ['7',   'Temp{ ºC}',        'cell5',	'Slaapkamer'            ,,      '>23.0'],

        ['34',  'Status',           'cell6',    'Deur woonkamer'        ,"color:orange",,   "Open",     "Dicht",        false   ],
        ['35',  'Status',           'cell7',    'Deur keuken'           ,"color:orange",,   "Open",     "Dicht",        false   ],
        ['36',  'Status',           'cell8',    'Voordeur'              ,"color:orange",,   "Open",     "Dicht",        false   ],
        ['47',  'Status',           'cell9',    'Schuurdeur'            ,"color:orange",,   "Open",     "Dicht",        false   ],
        ['49',  'Status',           'cell10',   'Garage roldeur'        ,"color:orange",,   "Open",     "Dicht",        false   ],
        
        ['33',  'Status',           'cell11',   'Tafellamp'             ,"color:green",     '=="Uit"',          "Aan",      "Uit"   ],
        ['20',  'Status',           'cell12',   'Zwarte lamp'           ,"color:green",     '=="Uit"',          "Aan",      "Uit"   ],
        ['21',  'Status',           'cell13',   'Staande lamp'          ,"color:green",     '=="Uit"',          "Aan",      "Uit"   ],
        ['22',  'Status',           'cell14',   'TV lamp'               ,"color:green",     '=="Uit"',          "Aan",      "Uit"   ],
        ['23',  'Status',           'cell15',   'Hal lamp'              ,"color:green",     '=="Uit"',          "Aan",      "Uit"   ],
        
        ['31',  'Status',           'cell16',   'Mac Pro'               ,"color:green",     '=="Offline"',      "Online",   "Offline",      false   ],
        ['32',  'Status',           'cell17',   'Mac Mini'              ,"color:green",     '=="Offline"',      "Online",   "Offline",      false   ],
        ['24',  'Status',           'cell18',   'Kevin'                 ,"color:green",     '=="Niet thuis"',   "Thuis",    "Niet thuis",   false   ],
        ['30',  'Status',           'cell19',   'Willemijn'             ,"color:green",     '=="Niet thuis"',   "Thuis",    "Niet thuis",   false   ],

        ['4',   'Temp{ ºC}',        'cell21',   'Raspberry temperatuur' ,"color:lightblue"],
        ['5',   'Data',             'cell22',   'Raspberry CPU'         ,"color:lightblue"],
        ['1',   'Data',             'cell23',   'Raspberry memory'      ,"color:lightblue"],

/*
        ['8',   'Humidity',         'cell15',	'Vocht woonkamer (%)',		'color:teal',		'<55'],
        ['7',   'Barometer',        'cell23',	'Barometer (hPa)'],
        ['83',  'ForecastStr',      'cell22',	'Weersvoorspelling',		'color:darkorange'],
        ['21',  'Usage',            'cell13',	'Electra nu (W)',		'color:#C34A2C;',	'>3000'],
        ['21',  'CounterToday',     'cell18',	'Electra vandaag (kWh)',	'color:#C34A2C;',	'>20'],
        ['80',  'Rain',             'cell16',	'Regen vandaag (mm)',		'color:lightblue'],
        ['80',  'RainRate',         'cell11',	'Regen nu (mm/h)',		'color:lightblue', 	'>8'],
        ['79',  'UVI',              'cell21',	'UV straling (UVI)',		'color:orange',		'>4'],
        ['78',  'Speed',            'cell17',	'Wind (km/h)',			'color:blue',		'>10'],
        ['78',  'DirectionStr',     'cell12',	'Windrichting',			'color:blue'],
        ['46',  'Status',           'cell8',	'Eettafel lamp'],
        ['111', 'Status',           'cell6',	'Wii',				'color:teal' ],
        ['86',  'Status',           'cell7',	'Timer sproeiers'],
*/
	];

// ############################################################################################################
// #### ^^^^^   USER VALUES above ^^^^^   #######
// ############################################################################################################


    RefreshData();
});  


function SwitchToggle(idx, switchcmd)
{
	 console.log('function called');
	 $.ajax({
     url: "json.htm?type=command&param=switchlight" + "&idx=" + idx + "&switchcmd=" + switchcmd + "&level=0",
     async: false, 
     dataType: 'json',
     success: function(){
     	console.log('SUCCES');
     },
     error: function(){
     	console.log('ERROR');
     }
 	});
 	RefreshData();
}


</script>

</body>
</html>
